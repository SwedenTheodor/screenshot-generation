/*! Angular Screenshot - v0.1.0 - http://weihanchen.github.io/angular-screenshot - (c) 2017 weihanchen - MIT */
!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var r=n(4),a=o(r),s=n(3),c=function(){var e=function(e,t,n,o){var r={gray:"#898b89",lightGray:"#e6e3e3"},c={top:1,second:0},i='<div><button ng-click="screenshotCtrl.download()">Download</button><button ng-click="screenshotCtrl.cancel()">Cancel</button></div>',u=5,l=this,f=function(e,t,n,o,r){var a=e+n.startX+n.w,s=t+n.startY+n.h;return n.w>=0&&(a-=o),n.h>=0?s+=u:s=s-r-u,{left:a,top:s}},d=function(){s.domprocess.remove(l.toolboxElement),s.domprocess.clearCanvasRect(l.interactiveCanvas)},p=function(){var e=v();s.domcapture.getCanvas(e).then(s.domprocess.canvasToImage).then(function(e){return s.domprocess.clipImageToCanvas(e,l.rect.startX,l.rect.startY,l.rect.w,l.rect.h)}).then(s.domprocess.downloadCanvas)},m=function(){var e=0;return a.element("body *").each(function(){var t=a.element(this).css("zIndex");t>e&&(e=t)}),e},v=function(){return l.target?a.element(l.target)[0]:t.children()[0]},h=function(){return l.template?l.template:i},g=function(){return l.templateScope?l.templateScope:e},y=function(){var e=m();c.second=e+1,c.top=c.second+1},w=function(){s.domprocess.remove(l.toolboxElement)},x=function(e,t){if(0!=t.w&&0!=t.h){l.rect=t;var o=n(h())(g()),r=o[0];s.domprocess.setToolboxStackStyle(r,c.top).then(s.domprocess.appendToBody).then(function(n){var o=f(e.offsetLeft,e.offsetTop,t,n.offsetWidth,n.offsetHeight);return s.domprocess.setToolboxPositionStyle(n,o.left,o.top)}).then(function(e){l.toolboxElement=e})}},b=function(){s.domprocess.remove(l.interactiveCanvas),s.domprocess.remove(l.toolboxElement)},C=function(){var e=v(),t=e.offsetWidth,n=e.offsetHeight,o=e.offsetLeft,a=e.offsetTop;y(),s.domprocess.createCanvas(t,n).then(function(e){return s.domprocess.setCanvasStyle(e,o,a,r.gray,c.second)}).then(s.domprocess.appendToBody).then(function(e){return s.domprocess.listenInteractiveCanvas(e,r.lightGray,x,w)}).then(function(e){return l.interactiveCanvas=e})};l.cancel=d,l.download=p,l.interactiveCanvas,l.rect={},l.toolboxElement,o(function(){return l.api={download:p,cancel:d}}),e.$watch(function(){return l.isOpen},function(e){e===!0?C():e===!1&&b()})};return{restrict:"AE",scope:{template:"=?",templateScope:"=?",target:"=",isOpen:"=",api:"="},controller:["$scope","$element","$compile","$timeout",e],controllerAs:"screenshotCtrl",bindToController:!0}};a.module("angular-screenshot",[]).directive("screenshot",c)},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0});var o="http://www.w3.org/2000/svg",r=function(e){return s(e).then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})},a=function(e){return new Promise(function(t,n){var o=new Image;o.onload=function(){t(o)},o.onerror=n,o.src=e})},s=function(){var e=document.styleSheets;if(!e)return Promise.resolve("");var t=l(e),o=t.reduce(function(e,t){var o=l(t.rules||t.cssRules);return e.push.apply(e,n(o.map(function(e){return e.cssText}))),e},[]).filter(function(e){return e}).join("");return Promise.resolve(o)},c=function(e){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns",e.namespaceURI),(new XMLSerializer).serializeToString(e)}).then(function(e){return"<foreignObject x='0' y='0' width='100%' height='100%'>"+e+"</foreignObject>"}).then(function(e){return"<svg xmlns='"+o+"' width='100%' height='100%'>"+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})},i=function(e){var t=e.cloneNode(!0),n=e.offsetWidth,o=e.offsetHeight;return Promise.resolve(t).then(r).then(c).then(a).then(function(e){var t=document.createElement("canvas");return t.width=n,t.height=o,t.getContext("2d").drawImage(e,0,0),t})},u=function(e){var t=e.cloneNode(!0);return Promise.resolve(t).then(r).then(c).then(a)},l=function(e){return Object.keys(e).map(function(t){return e[t]})},f={getCanvas:i,getCanvasImage:u};t.default=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return document.body.appendChild(e),Promise.resolve(e)},o=function(e){return new Promise(function(t,n){var o=e.toDataURL("image/png"),r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=o})},r=function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)},a=function(e,t,n,o,r){return c(Math.abs(o),Math.abs(r)).then(function(a){var s=a.getContext("2d");return s.drawImage(e,t,n,o,r,0,0,a.width,a.height),a})},s=function(e){var t=e.toDataURL("image/png"),n=document.createElement("a");return n.href=t,n.download="screenshot.png",n.target="_blank",n.click(),n.remove(),Promise.resolve(e)},c=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,Promise.resolve(n)},i=function(e,t,n,o){var r=e.getContext("2d"),a={startX:0,startY:0,w:0,h:0},s=!1,c=function(){r.fillStyle=t,r.fillRect(a.startX,a.startY,a.w,a.h)},i=function(t){r.clearRect(0,0,e.width,e.height),a.startX=t.pageX-e.offsetLeft,a.startY=t.pageY-e.offsetTop,o(a),a.w=0,a.h=0,s=!0},u=function(t){s&&(a.w=t.pageX-e.offsetLeft-a.startX,a.h=t.pageY-e.offsetTop-a.startY,r.clearRect(0,0,e.width,e.height),c())},l=function(){s=!1,n(e,a)};return e.addEventListener("mousedown",i,!1),e.addEventListener("mouseup",l,!1),e.addEventListener("mousemove",u,!1),Promise.resolve(e)},u=function(e){e&&e.remove()},l=function(e,t,n,o,r){return e.style.cursor="crosshair",e.style.position="absolute",e.style.left=t+"px",e.style.top=n+"px",e.style.background=o,e.style.zIndex=r,e.style.opacity=.5,Promise.resolve(e)},f=function(e,t,n){return e.style.left=t+"px",e.style.top=n+"px",Promise.resolve(e)},d=function(e,t){return e.style.position="absolute",e.style.zIndex=t,Promise.resolve(e)},p={appendToBody:n,canvasToImage:o,clearCanvasRect:r,clipImageToCanvas:a,createCanvas:c,downloadCanvas:s,listenInteractiveCanvas:i,remove:u,setCanvasStyle:l,setToolboxPositionStyle:f,setToolboxStackStyle:d};t.default=p},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.domprocess=t.domcapture=void 0;var r=n(1),a=o(r),s=n(2),c=o(s);t.domcapture=a.default,t.domprocess=c.default,t.default={domcapture:a.default,domprocess:c.default}},function(e,t){e.exports=angular}]);